{"ast":null,"code":"import _slicedToArray from \"/Users/richardchea/development/code/covisualize/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport * as TWEEN from 'es6-tween';\nimport * as THREE from 'three';\n\nfunction random(scaleFactor) {\n  return Math.random() > 0.5 ? scaleFactor * Math.random() : -scaleFactor * Math.random();\n}\n\nvar MARKER_COLOR = '#fcffbe';\nvar MARKER_COMPANION_COLOR = '#fff9e6';\nexport default function markerRenderer(marker) {\n  var size = Math.max(marker.value / 20, 1);\n  var geometry = new THREE.SphereGeometry(size, 10, 10);\n  var material = new THREE.MeshBasicMaterial({\n    color: new THREE.Color(MARKER_COLOR)\n  }); // add light\n\n  var mesh = new THREE.Mesh(geometry, material);\n  var light = new THREE.PointLight(MARKER_COLOR, 1, 0, 0);\n  mesh.children = [];\n  mesh.add(light); // add companion markers based on size\n\n  var companions = [];\n\n  for (var i = 0; i < 10; i++) {\n    var companionGeometry = new THREE.SphereGeometry(Math.min(size * Math.random() / 2, 1), 10, 10);\n    var companionMaterial = new THREE.MeshBasicMaterial({\n      color: new THREE.Color(MARKER_COMPANION_COLOR)\n    });\n    var companion = new THREE.Mesh(companionGeometry, companionMaterial);\n    companion.lookAt(new THREE.Vector3(0, 0, 0));\n    companions.push(companion);\n    mesh.add(companion);\n  }\n\n  companions.forEach(function (companion, i) {\n    function animate() {\n      var from = {\n        opacity: 0.1,\n        position: companion.position.clone().toArray(),\n        scale: Math.max(0.5, Math.random())\n      };\n      var to = {\n        opacity: 0.5,\n        position: [random(size * 3), random(size * 3), random(size)],\n        scale: 0.01\n      };\n      var tween = new TWEEN.Tween(from).to(to, 4000).easing(TWEEN.Easing.Quadratic.InOut).delay(i * 200);\n      tween.on('update', function () {\n        var _from$position = _slicedToArray(from.position, 3),\n            x = _from$position[0],\n            y = _from$position[1],\n            z = _from$position[2];\n\n        var companionMaterial = companion.material;\n        var intensityChange = random(0.05);\n\n        if (light.intensity + intensityChange > 0 && light.intensity + intensityChange < 1.5) {\n          light.intensity += intensityChange;\n        }\n\n        companionMaterial.opacity = from.opacity;\n        companion.scale.x = from.scale;\n        companion.scale.y = from.scale;\n        companion.scale.z = from.scale;\n        companion.position.set(x, y, z);\n      }).on('complete', animate).start();\n    }\n\n    animate();\n  });\n  return mesh;\n}","map":{"version":3,"sources":["/Users/richardchea/development/code/covisualize/src/MarkerRenderer.ts"],"names":["TWEEN","THREE","random","scaleFactor","Math","MARKER_COLOR","MARKER_COMPANION_COLOR","markerRenderer","marker","size","max","value","geometry","SphereGeometry","material","MeshBasicMaterial","color","Color","mesh","Mesh","light","PointLight","children","add","companions","i","companionGeometry","min","companionMaterial","companion","lookAt","Vector3","push","forEach","animate","from","opacity","position","clone","toArray","scale","to","tween","Tween","easing","Easing","Quadratic","InOut","delay","on","x","y","z","intensityChange","intensity","set","start"],"mappings":"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","sourcesContent":["import * as TWEEN from 'es6-tween';\nimport * as THREE from 'three';\n\nimport { Marker } from 'react-globe';\n\nfunction random(scaleFactor: number): number {\n  return Math.random() > 0.5\n    ? scaleFactor * Math.random()\n    : -scaleFactor * Math.random();\n}\n\nconst MARKER_COLOR = '#fcffbe';\nconst MARKER_COMPANION_COLOR = '#fff9e6';\n\nexport default function markerRenderer(marker: Marker): THREE.Object3D {\n  const size = Math.max(marker.value / 20, 1);\n  const geometry = new THREE.SphereGeometry(size, 10, 10);\n  const material = new THREE.MeshBasicMaterial({\n    color: new THREE.Color(MARKER_COLOR),\n  });\n\n  // add light\n  const mesh = new THREE.Mesh(geometry, material);\n  const light = new THREE.PointLight(MARKER_COLOR, 1, 0, 0);\n  mesh.children = [];\n  mesh.add(light);\n\n  // add companion markers based on size\n  const companions: THREE.Mesh[] = [];\n  for (let i = 0; i < 10; i++) {\n    const companionGeometry = new THREE.SphereGeometry(\n      Math.min((size * Math.random()) / 2, 1),\n      10,\n      10,\n    );\n    const companionMaterial = new THREE.MeshBasicMaterial({\n      color: new THREE.Color(MARKER_COMPANION_COLOR),\n    });\n    const companion = new THREE.Mesh(companionGeometry, companionMaterial);\n    companion.lookAt(new THREE.Vector3(0, 0, 0));\n    companions.push(companion);\n    mesh.add(companion);\n  }\n\n  companions.forEach(\n    (companion, i: number): void => {\n      function animate(): void {\n        const from = {\n          opacity: 0.1,\n          position: companion.position.clone().toArray(),\n          scale: Math.max(0.5, Math.random()),\n        };\n        const to = {\n          opacity: 0.5,\n          position: [random(size * 3), random(size * 3), random(size)],\n          scale: 0.01,\n        };\n        const tween = new TWEEN.Tween(from)\n          .to(to, 4000)\n          .easing(TWEEN.Easing.Quadratic.InOut)\n          .delay(i * 200);\n        tween\n          .on(\n            'update',\n            (): void => {\n              const [x, y, z] = from.position;\n              const companionMaterial = companion.material as THREE.MeshBasicMaterial;\n              const intensityChange = random(0.05);\n              if (\n                light.intensity + intensityChange > 0 &&\n                light.intensity + intensityChange < 1.5\n              ) {\n                light.intensity += intensityChange;\n              }\n              companionMaterial.opacity = from.opacity;\n              companion.scale.x = from.scale;\n              companion.scale.y = from.scale;\n              companion.scale.z = from.scale;\n              companion.position.set(x, y, z);\n            },\n          )\n          .on('complete', animate)\n          .start();\n      }\n      animate();\n    },\n  );\n  return mesh;\n}\n"]},"metadata":{},"sourceType":"module"}